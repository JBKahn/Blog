<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Vagrant Plugin: Back 2 Tha Hood &#8211; A Byte Of The Apple</title>
<meta name="description" content="My journey to create a useful vagrant plugin for work">
<meta name="keywords" content="post">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Vagrant Plugin: Back 2 Tha Hood">
<meta name="twitter:description" content="My journey to create a useful vagrant plugin for work">
<meta name="twitter:site" content="@JosephBKahn">
<meta name="twitter:creator" content="@JosephBKahn">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.josephkahn.io/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Vagrant Plugin: Back 2 Tha Hood">
<meta property="og:description" content="My journey to create a useful vagrant plugin for work">
<meta property="og:url" content="https://blog.josephkahn.io/articles/vagrant-plugin/">
<meta property="og:site_name" content="A Byte Of The Apple">





<link rel="canonical" href="https://blog.josephkahn.io/articles/vagrant-plugin/">
<link href="https://blog.josephkahn.io/feed.xml" type="application/atom+xml" rel="alternate" title="A Byte Of The Apple Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://blog.josephkahn.io/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="https://blog.josephkahn.io/assets/js/vendor/html5shiv.min.js"></script>
  <script src="https://blog.josephkahn.io/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="https://blog.josephkahn.io/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://blog.josephkahn.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://blog.josephkahn.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://blog.josephkahn.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://blog.josephkahn.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://blog.josephkahn.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://blog.josephkahn.io/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="https://blog.josephkahn.io/about/" >About</a></li>
		  
		    
		    <li><a href="https://blog.josephkahn.io/articles/" >Articles</a></li>
		  
		    
		    <li><a href="http://josephkahn.io" target="_blank">My Website</a></li>
		  
		    
		    <li><a href="https://blog.josephkahn.io/feed.xml" >Feed</a></li>
		  
		    
		    <li><a href="https://blog.josephkahn.io/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title animated fadeIn"><a href="https://blog.josephkahn.io/">A Byte Of The Apple</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Becoming A Better Developer One Mistake At A Time</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="https://blog.josephkahn.io/tags/#post" title="Pages tagged post">post</a></li>
        </ul>
        
          <h1 class="entry-title">Vagrant Plugin: Back 2 Tha Hood</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="https://blog.josephkahn.io/images/bio-photo.jpg" class="bio-photo" alt="Joseph Kahn bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Joseph Kahn</span></span>
        <span class="entry-date date published"><time datetime="2015-01-25T00:00:00-05:00"><i class="fa fa-calendar-o"></i> January 25, 2015</time></span>
        <span class="entry-date date modified"><time datetime="2015-01-25"><i class="fa fa-pencil"></i> January 25, 2015</time></span>
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        <span class="social-share-twitter">
  <a href="https://twitter.com/intent/tweet?hashtags=post&amp;text=Vagrant%20Plugin:%20Back%202%20Tha%20Hood&amp;url=https://blog.josephkahn.io/articles/vagrant-plugin/&amp;via=JosephBKahn" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square"></i> Tweet</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=https://blog.josephkahn.io/articles/vagrant-plugin/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square"></i> Like</a>
</span>
<span class="social-share-googleplus">
  <a href="https://plus.google.com/share?url=https://blog.josephkahn.io/articles/vagrant-plugin/" title="Share on Google Plus" itemprop="GooglePlus"><i class="fa fa-google-plus-square"></i> +1</a>
</span>
<!-- /.social-share -->
        
      </footer>
      <div class="entry-content">
        <h1 id="introduction">Introduction</h1>

<p>Once again, writing a post after a long break from updating my blog. I found my free time began to disappear when I started taking class at night after work and didn’t have much time for blogging. When my co-op finished in September, I then worked part time between my classes and finished up the last of my requirements. This has been my first month back to work and getting used to having some free time again.</p>

<p>In school I covered a variety of topics from databases and PHP to the SOLID principles. I might try to make a post about something I covered in school over the next few weeks. I’ve also gotten back into reading and just finished <a href="http://www.amazon.ca/Geek-Sublime-The-Beauty-Code/dp/1555976859">Geek Sublime: The Beauty of Code, the Code of Beauty</a> as it was a gift from a friend. The book was pretty interesting and yet it did seem a bit dry at times and certain passages seemed to go on forever. Anyway, on to the good stuff.</p>

<p>One thing I was attempting to do this week at work was to write a custom Vagrant command. For those of you unfamiliar with Vagrant, it’s a wrapper around tools like VirtualBox. It makes configuring, creating, and managing virtual machines for development a lot easier. It also provides some useful commands to make starting and using VMs easier.</p>

<p>When I first started researching how to make custom commands, it seemed rather daunting. The work to gain ratio seemed to be a lot higher than I’d imagined. I had thought it would be a few lines of configuration to map command X with function Y, but that was just not the case.</p>

<h1 id="woes-with-creating-the-plugin">Woes With Creating The Plugin</h1>

<p>As far as I can tell, in the current version of Vagrant, there is only one way to build these and that is through their plugin system. Once again I was hopeful as I dashed into the <a href="https://docs.vagrantup.com/v2/plugins/index.html">documentation</a> and found this:</p>

<blockquote>
  <p>Warning: Advanced Topic! Developing plugins is an advanced topic that only experienced Vagrant users who are reasonably comfortable with Ruby should approach.</p>
</blockquote>

<p>As far as I was aware, I was neither an experienced Vagrant user or reasonably comfortable with Ruby…so I was preparing for the worst. Apparently, all plugins are to defined as gems, regardless of complexity. My only experience with gems was to run <code class="highlighter-rouge">bundle install</code> to be able to work on this blog. I figured it couldn’t be too hard to do and they must have examples of how to build them. I was sadly mistaken and confused as began researching. I found confusing documentation and half-examples with decent explanation or full examples with none. I was flummoxed.</p>

<p>I thought, how can there not be a complete (and easy to follow) Hello World type example for those who know little of Ruby? The documentation was the closest I could find but instead of giving you the full story, they leave that warning. I hope this will serve as an example to the next person who just wants a simple custom vagrant command.</p>

<h1 id="it-begins">It Begins</h1>

<p>The first thing you need for a gem file is the structure. Apparently you can auto-generate the skeleton, I opted to take a simple gem and make my changes. Here’s the file structure of my gem:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Gemfile                         # The is where I put my dependancies.
Rakefile                        # The is somehow tied to building the gem.
vagrant-custom-command.gemspec  # The information/build data, like a `setup.py` file.
lib/
--- vagrant-custom-command.rb   # This is the top level file of the command.
--- custom-command/
--- --- command.rb              # The logic of the command and the argument parsing.
--- --- plugin.rb               # Defining the command and point it at `command.rb`.</code></pre></figure>

<p>There aren’t too many files here , it was reasonably easy to make a custom gem. I’m not making use of any other ruby gems or doing anything complex.</p>

<h1 id="the-files">The Files</h1>

<h1 id="gemfile">Gemfile</h1>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="n">gemspec</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'vagrant'</span><span class="p">,</span>         <span class="ss">github: </span><span class="s1">'mitchellh/vagrant'</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>As you can see, I’ve just defined vagrant as a requirement for development, that’s all. Simple file.</p>

<h2 id="rakefile">Rakefile</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="nb">require</span> <span class="s2">"bundler/gem_tasks"</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>I don’t know why this is here, at some point I’d like to delve more into Ruby. For the moment I just accept that this works and that that line is suffient to use <code class="highlighter-rouge">rake build</code>.</p>

<h2 id="vagrant-custom-commandgemspec">vagrant-custom-command.gemspec</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><pre><span class="c1"># coding: utf-8</span>
<span class="n">lib</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s1">'../lib'</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>
<span class="vg">$LOAD_PATH</span><span class="p">.</span><span class="nf">unshift</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span> <span class="k">unless</span> <span class="vg">$LOAD_PATH</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span>

<span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">spec</span><span class="o">|</span>
  <span class="n">spec</span><span class="p">.</span><span class="nf">name</span>          <span class="o">=</span> <span class="s2">"vagrant-custom-command"</span>
  <span class="n">spec</span><span class="p">.</span><span class="nf">version</span>       <span class="o">=</span> <span class="mi">1</span>
  <span class="n">spec</span><span class="p">.</span><span class="nf">authors</span>       <span class="o">=</span> <span class="p">[</span><span class="s2">"Joseph Kahn"</span><span class="p">]</span>
  <span class="n">spec</span><span class="p">.</span><span class="nf">email</span>         <span class="o">=</span> <span class="p">[</span><span class="s2">"JosephBKahn@gmail.com"</span><span class="p">]</span>
  <span class="n">spec</span><span class="p">.</span><span class="nf">description</span>   <span class="o">=</span> <span class="sx">%q{Awesome custom command to do something}</span>
  <span class="n">spec</span><span class="p">.</span><span class="nf">summary</span>       <span class="o">=</span> <span class="n">spec</span><span class="p">.</span><span class="nf">description</span>
  <span class="n">spec</span><span class="p">.</span><span class="nf">homepage</span>      <span class="o">=</span> <span class="s2">"&lt;repo url&gt;"</span>

  <span class="n">spec</span><span class="p">.</span><span class="nf">files</span>         <span class="o">=</span> <span class="sb">`git ls-files`</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="vg">$/</span><span class="p">)</span>
  <span class="n">spec</span><span class="p">.</span><span class="nf">executables</span>   <span class="o">=</span> <span class="n">spec</span><span class="p">.</span><span class="nf">files</span><span class="p">.</span><span class="nf">grep</span><span class="p">(</span><span class="sr">%r{^bin/}</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="no">File</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">spec</span><span class="p">.</span><span class="nf">require_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"lib"</span><span class="p">]</span>

  <span class="n">spec</span><span class="p">.</span><span class="nf">add_development_dependency</span> <span class="s2">"bundler"</span><span class="p">,</span> <span class="s2">"~&gt; 1.3"</span>
  <span class="n">spec</span><span class="p">.</span><span class="nf">add_development_dependency</span> <span class="s2">"rake"</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>That’s pretty straight forward. I think I used bundler to install rake and rake to build the module so that’s what this gem required for development.</p>

<h2 id="vagrant-project-setuprb">vagrant-project-setup.rb</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="nb">require_relative</span> <span class="s1">'custom-command/plugin'</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>This file is just going to use the following <code class="highlighter-rouge">plugin.rb</code> file and exists in here to make the directory structure clean.</p>

<h2 id="pluginrb">plugin.rb</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">VagrantPlugins</span>
  <span class="k">module</span> <span class="nn">CustomCommand</span>
    <span class="k">class</span> <span class="nc">Plugin</span> <span class="o">&lt;</span> <span class="no">Vagrant</span><span class="p">.</span><span class="nf">plugin</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
      <span class="nb">name</span> <span class="s1">'test'</span>
      <span class="n">description</span> <span class="s1">'testing'</span>

      <span class="n">command</span> <span class="s2">"hello"</span> <span class="k">do</span>
        <span class="nb">require_relative</span> <span class="s2">"command"</span>
        <span class="no">Command</span>
      <span class="k">end</span>

    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>All this file does it to register a command which can be called using <code class="highlighter-rouge">vagrant hello</code> and then will execute the logic in the <code class="highlighter-rouge">command.rb</code> file.</p>

<h2 id="commandrb">command.rb</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">VagrantPlugins</span>
  <span class="k">module</span> <span class="nn">CustomCommand</span>
    <span class="k">class</span> <span class="nc">Command</span> <span class="o">&lt;</span> <span class="no">Vagrant</span><span class="p">.</span><span class="nf">plugin</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="ss">:command</span><span class="p">)</span>
      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">synopsis</span>
        <span class="s2">"Prints Hello World"</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">execute</span>
        <span class="nb">puts</span> <span class="s2">"Hello World!"</span>
        <span class="k">return</span> <span class="mi">0</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The execute function is the code that is executed when it’s called and the synopsis is how the command is described under <code class="highlighter-rouge">vagrant list-commands</code>.</p>

<p>The above snippet prints <code class="highlighter-rouge">Hello World!</code> to the screen and exits with a 0 status.</p>

<h2 id="more-complex-commandrb">More Complex <code class="highlighter-rouge">command.rb</code></h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">VagrantPlugins</span>
  <span class="k">module</span> <span class="nn">CustomCommand</span>
    <span class="k">class</span> <span class="nc">Command</span> <span class="o">&lt;</span> <span class="no">Vagrant</span><span class="p">.</span><span class="nf">plugin</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="ss">:command</span><span class="p">)</span>
      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">synopsis</span>
        <span class="s2">"Calls an Ansible script to do something."</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">execute</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">options</span><span class="p">[</span><span class="ss">:optionA</span><span class="p">]</span> <span class="o">=</span> <span class="kp">false</span>
        <span class="n">options</span><span class="p">[</span><span class="ss">:optionB</span><span class="p">]</span> <span class="o">=</span> <span class="kp">false</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="no">OptionParser</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">o</span><span class="o">|</span>
          <span class="n">o</span><span class="p">.</span><span class="nf">banner</span> <span class="o">=</span> <span class="s2">"Usage: vagrant blah [item]"</span>
          <span class="n">o</span><span class="p">.</span><span class="nf">separator</span> <span class="s2">""</span>

          <span class="n">o</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="s2">"-a"</span><span class="p">,</span> <span class="s2">"--optionA"</span><span class="p">,</span> <span class="s2">"do something conditional."</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">a</span><span class="o">|</span>
            <span class="n">options</span><span class="p">[</span><span class="ss">:optionA</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
          <span class="k">end</span>
          <span class="n">o</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="s2">"-b"</span><span class="p">,</span> <span class="s2">"--optionB"</span><span class="p">,</span> <span class="s2">"do something conditional."</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
            <span class="n">options</span><span class="p">[</span><span class="ss">:optionB</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">argv</span> <span class="o">=</span> <span class="n">parse_options</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">argv</span><span class="p">.</span><span class="nf">length</span> <span class="o">==</span> <span class="mi">0</span>
          <span class="nb">puts</span> <span class="s2">"You must specify at least one item."</span>
          <span class="k">return</span> <span class="mi">1</span>
        <span class="k">end</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">argv</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span>

        <span class="n">host_arg</span> <span class="o">=</span> <span class="s2">"-i ./provisioning/hosts_file"</span>
        <span class="n">private_key_arg</span> <span class="o">=</span> <span class="s2">"--private-key=./.vagrant/machines/default/virtualbox/private_key"</span>
        <span class="n">user_arg</span> <span class="o">=</span> <span class="s2">"-u vagrant"</span>
        <span class="n">playbook_path</span> <span class="o">=</span> <span class="s2">"./provisioning/some_playbook.yml"</span>
        <span class="n">extra_vars</span> <span class="o">=</span> <span class="s2">"--extra-vars </span><span class="se">\"</span><span class="s2">items=</span><span class="si">#{</span><span class="n">items</span><span class="si">}</span><span class="s2"> option_a=</span><span class="si">#{</span><span class="n">options</span><span class="p">[</span><span class="ss">:optionA</span><span class="p">]</span><span class="si">}</span><span class="s2"> option_b=</span><span class="si">#{</span><span class="n">options</span><span class="p">[</span><span class="ss">:optionB</span><span class="p">]</span><span class="si">}</span><span class="se">\"</span><span class="s2">"</span>

        <span class="n">result</span> <span class="o">=</span> <span class="nb">system</span><span class="p">(</span><span class="s2">"ansible-playbook </span><span class="si">#{</span><span class="n">host_arg</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">private_key_arg</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">user_arg</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">playbook_path</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">exatra_vars</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="nf">nil?</span>
          <span class="nb">puts</span> <span class="s2">"Error was </span><span class="si">#{</span><span class="vg">$?</span><span class="si">}</span><span class="s2">"</span>
          <span class="k">return</span> <span class="mi">1</span>
        <span class="k">end</span>
        <span class="nb">puts</span> <span class="s2">"Success!!"</span>
        <span class="k">return</span> <span class="mi">0</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>In this example, I’m using the built-in option parsing to pass a list of items and two conditionals to an ansible playbook. That snippet is pretty straight forward until we get to the system call. I had to specify the vagrant user and give vagrant’s private key to have sufficient privileges to run this playbook. This makes it easier for the other developers to run these commands. They don’t need to remember the full command or where the <code class="highlighter-rouge">private_key</code> file is.</p>

<h1 id="building-testing--usage">Building, Testing &amp; Usage</h1>

<p>In order to build the file, I downloaded ruby (I use rvm) and bundler following their documentation. After installing rvm, I ran <code class="highlighter-rouge">rvm all do gem install bundler</code> (I only have one version of Ruby installed, otherwise I would have specified which). Once I had both of those, I ran <code class="highlighter-rouge">rake build</code> to build my plugin. That created a <code class="highlighter-rouge">.gem</code> file in a <code class="highlighter-rouge">pkg</code> directory it created at the root of the gem.</p>

<p>Once I had the gem file, I went to my vagrant folder for the project and ran <code class="highlighter-rouge">vagrant plugin install &lt;path to gem file&gt;</code>. Once it’s installed, a simple <code class="highlighter-rouge">vagrant hello</code> will test whether the plgin works and will return an error if there was an issue. During development I would continuously run <code class="highlighter-rouge">vagrant plugin uninstall vagrant-custom-command &amp;&amp; vagran plugin install &lt;path to gem&gt;</code>.</p>

<h1 id="conclusion">Conclusion</h1>

<p>I feel that plugin creation is a bit more complicated than it should have been for a <code class="highlighter-rouge">Hello World</code> case. It seems a bit like overkill for printing something to the screen. Hiding behind a warning makes the initial plunge into vagrant plugins that much scarier and harder. While I had a few hiccups during development, it was more confusing because I thought it was more difficult than it turned out to be. I didn’t see an easier way to define something simple inside the <code class="highlighter-rouge">Vagrantfile</code> or anything like that. I hope this post helps the next confused person overcome those hurdles be on their way to make a great plugin.</p>

<p>If you have any suggestions on an easier way to do this, information on the gem that I missed, or any part of this than please leave a comment below.</p>

        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'abyteoftheapplejbkahn'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="https://blog.josephkahn.io/articles/ansible-modules/" class="btn" title="For a Few Ansible Modules More">Previous</a>
      
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2016 Joseph Kahn. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/JosephBKahn" title="Joseph Kahn on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="https://facebook.com/josephkahn" title="Joseph Kahn on Facebook" target="_blank"><i class="fa fa-facebook-square fa-2x"></i></a>
	
	<a href="https://linkedin.com/in/jbkahn" title="Joseph Kahn on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
	
	
	
	<a href="https://github.com/JBKahn" title="Joseph Kahn on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="https://blog.josephkahn.io/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'https://blog.josephkahn.io';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://blog.josephkahn.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://blog.josephkahn.io/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 'https://www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-49300323-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = 'https://stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



</body>
</html>
